### 6.4.1 Xacro\_快速体验

快速上手 Xacro,实现可编程的 URDF 文件编写

**需求描述:**

编写一个底盘，底盘上添加两个轮子，需要使用变量封装底盘的半径、高度，使用数学公式动态计算底盘的关节点坐标，使用 Xacro 宏封装轮子重复的代码并调用创建两个轮子\(注意: 在此，演示 Xacro 的基本使用，不必要生成合法的 URDF \)

**准备:**

创建功能包，导入 urdf 与 xacro

#### 1.Xacro文件编写

```xml
<robot name="mycar" xmlns:xacro="http://wiki.ros.org/xacro">
    <!-- 使用变量封装参数 -->
    <xacro:property name="base_footprint_radius" value="0.001" />
    <xacro:property name="base_link_radius" value="0.1" />
    <xacro:property name="base_link_length" value="0.08" />
    <xacro:property name="lidi_jianju" value="0.015" />

    <link name="base_link">
        <origin xyz="0 0 ${lidi_jianju + base_link_radius / 2}" />
    </link>

    <xacro:macro name="add_wheel" params="name flag">
        <link name="${name}_wheel">
            <visual>
                <geometry>
                    <cylinder radius="0.0325" length="0.015" />
                </geometry>
                <origin xyz="0 0 0" rpy="1.5705 0 0" />
                <material name="black">
                    <color rgba="0.0 0.0 0.0 1.0" />
                </material>
            </visual>
            <joint xyz="0 ${0.1 * flag } -0.0225 " />
        </link>
    </xacro:macro>
    <xacro:add_wheel name="left" flag="1" />
    <xacro:add_wheel name="right" flag="-1" />
</robot>
```

#### 2.Xacro文件转换成 urdf 文件

命令行进入 xacro文件 所属目录，执行:`rosrun xacro xacro xxx.xacro > xxx.urdf`, 会将 xacro 文件解析为 urdf 文件，内容如下:

```xml
<?xml version="1.0" ?>
<!-- =================================================================================== -->
<!-- |    This document was autogenerated by xacro from test.urdf.xacro                | -->
<!-- |    EDITING THIS FILE BY HAND IS NOT RECOMMENDED                                 | -->
<!-- =================================================================================== -->
<robot name="mycar">
  <link name="base_link">
    <origin xyz="0 0 0.065"/>
  </link>
  <link name="left_wheel">
    <visual>
      <geometry>
        <cylinder length="0.015" radius="0.0325"/>
      </geometry>
      <origin rpy="1.5705 0 0" xyz="0 0 0"/>
      <material name="black">
        <color rgba="0.0 0.0 0.0 1.0"/>
      </material>
    </visual>
    <joint xyz="0 0.1 -0.0225 "/>
  </link>
  <link name="right_wheel">
    <visual>
      <geometry>
        <cylinder length="0.015" radius="0.0325"/>
      </geometry>
      <origin rpy="1.5705 0 0" xyz="0 0 0"/>
      <material name="black">
        <color rgba="0.0 0.0 0.0 1.0"/>
      </material>
    </visual>
    <joint xyz="0 -0.1 -0.0225 "/>
  </link>
</robot>
```

注意: 该案例编写生成的是非法的 URDF 文件，目的在于演示 Xacro 的极简使用以及优点

