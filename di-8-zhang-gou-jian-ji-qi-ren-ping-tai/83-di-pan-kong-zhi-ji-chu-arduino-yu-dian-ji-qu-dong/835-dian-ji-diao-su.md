### 8.3.5 电机调速01\_PID控制理论

> 场景:
>
> 速度信息可以以m/s为单位，或者也可以转换成转速 r/s，而电机的转速是由PWM脉冲宽度来控制的，如何根据速度信息量化成合适的PWM至呢？
>
> 比如:现有一辆行驶中的无人车，要求将车速调整至100KM/h，那么应该如何向电机输出PWM值？或换言之，如何控制油门？

调速实现策略由多种，PID其中较为常用。

#### PID简介

**PID算法是一种经典、简单、高效的动态速度调节方式，P代表比例，I代表积分，D代表微分。**

PID公式如下：

![](/assets/PID公式.jpg)

* **e\(t\)**作为 PID 控制的输入；

* **u\(t\)**作为 PID 控制器的输出和被控对象的输入；

* **Kp **控制器的比例系数；

* **Ki**控制器的积分时间，也称积分系数；

* **Kd**控制器的微分时间，也称微分系数。

上述公式稍显晦涩，PID控制原理框架图更有助于理解:

![](/assets/PID控制.jpg)

##### 1.P

如果实现上述场景中的车速控制，一种简单的实现方式是: 确定目标速度，获取当前速度，使用`(目标速度-当前速度)*某一系数` 计算结果为输出的PWM，再获取当前速度，使用`(目标速度-当前速度)*某一系数` 计算结果累加上次的PWM并输出...如此循环

比如:

1. 目标速度为100KM/h，系数为0.5
2. 初始状态为静止0KM/h,差值为100,差值\*系数计算输出结果为50，当前速度可达 60KM/h
3. 初始速度为60KM/h,差值为40，差值\*系数计算结果为20，累加之后为70，当前速度可达84KM/h
4. 初始速度为84KM/h,差值为16，差值\*系数计算结果为8，累加之后为78，当前速度可达93.6KM/h
5. .... 以此类推，最终达成目标速度。

在上述模型中，调速实现是一个闭环，每一次循环都会根据当前时速与目标时速的差值，再乘以以固定系数，计算出需要增长的PWM值，这其中的系数，称之为比例，也是PID中的P。

##### 2.I

上述模型是理想状态实现，当PWM按照比例增长时，时速也是等比例增长的，但是实际状态下，可能由于内部外部因素的影响\(摩擦力、风阻等\)，时速不能等比例增长，每次循环中实际速度与预期速度存在稳态误差，这意味着最终结果可能永远无法达成预期，解决的方法就是使用积分I。

每次调速时，输出除了要累加计算的PWM之外，还要累加根据积分I计算的结果，以消除静态误差。

##### 3.D

仍然以模型1为例，当比例设置的过大时，可能会出先"超速"的情况，超速之后可能需要多次调整，产生系统震荡，具体到电机上表现，可能会出现抖动，解决这种情况可以使用D微分，当速度越是接近目标速度时，D就会越施加反方向力，减弱P的控制，起到类似”阻尼“的作用。通过D的使用可以减小系统震荡。

---

综上，PID闭环控制实现是结合了比例、积分和微分的一种控制机制，通过P可以以增量的方式计算输出，通过I可以消除稳态误差，通过D可以减小系统震荡，三者相结合，最终是要快速、精准且稳定的达成预期结果，而要实现该结果，还需要对这三个数值反复测试、调整...下一节将介绍在 Arduino 中PID控制的具体实现，其中就包括PID库的调用，以及PID调试的具体方式。

